
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Simple Resource Example Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-panel/icons.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-panel/panel.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-theme-api/theme-api.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    
    <link rel="prev" href="what_is_resource.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Getting Started</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../getting_started/why_kubernetes.html">
            
                <a href="../getting_started/why_kubernetes.html">
            
                    
                    Why Kubernetes APIs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../getting_started/what_is_kubebuilder.html">
            
                <a href="../getting_started/what_is_kubebuilder.html">
            
                    
                    What is Kubebuilder
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="../getting_started/installation_and_setup.html">
            
                <a href="../getting_started/installation_and_setup.html">
            
                    
                    Installation and Setup
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="../getting_started/hello_world.html">
            
                <a href="../getting_started/hello_world.html">
            
                    
                    Hello World
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Basics</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="project_creation_and_structure.html">
            
                <a href="project_creation_and_structure.html">
            
                    
                    Project Creation and Structure
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" >
            
                <span>
            
                    
                    Resource Fundamentals
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.2.1" data-path="what_is_resource.html">
            
                <a href="what_is_resource.html">
            
                    
                    What is a Resource
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="3.2.2" data-path="simple_resource.html">
            
                <a href="simple_resource.html">
            
                    
                    Simple Resource Example
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.3" >
            
                <span>
            
                    
                    Controller Fundamentals
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.3.1" data-path="what_is_controller.html">
            
                <a href="what_is_controller.html">
            
                    
                    What is a Contoller
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.2" data-path="simple_controller.html">
            
                <a href="simple_controller.html">
            
                    
                    Simple Controller Example
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.4" >
            
                <span>
            
                    
                    Cmd Fundamentals
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.4.1" data-path="register_controllers_resources.md">
            
                <span>
            
                    
                    Registering Controllers and Resources
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.5" data-path="development_workflow.html">
            
                <a href="development_workflow.html">
            
                    
                    Development Workflow
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Beyond the Basics</li>
        
        
    
        <li class="chapter " data-level="4.1" >
            
                <span>
            
                    
                    Resources
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.1" data-path="../beyond_the_basics/generated_code.html">
            
                <a href="../beyond_the_basics/generated_code.html">
            
                    
                    Configuring Generated Code
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2" data-path="../beyond_the_basics/handling_failures.md">
            
                <span>
            
                    
                    Handling Read / Write Failures
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.3" data-path="../beyond_the_basics/generated_code.html">
            
                <a href="../beyond_the_basics/generated_code.html">
            
                    
                    Non-Namespaced Objects
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.4" data-path="../beyond_the_basics/resource_versioning.html">
            
                <a href="../beyond_the_basics/resource_versioning.html">
            
                    
                    Multi Version Support
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.5" data-path="../beyond_the_basics/atomic_and_associative_fields.html">
            
                <a href="../beyond_the_basics/atomic_and_associative_fields.html">
            
                    
                    Atomic and Associative Fields
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.6" data-path="../beyond_the_basics/schema_validation_with_openapi.html">
            
                <a href="../beyond_the_basics/schema_validation_with_openapi.html">
            
                    
                    Validation using OpenAPI
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.7" data-path="../beyond_the_basics/additional_validation_with_webhooks.html">
            
                <a href="../beyond_the_basics/additional_validation_with_webhooks.html">
            
                    
                    Validation using Webhooks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.8" data-path="../beyond_the_basics/defaulting_and_canonicalization_with_webhooks.html">
            
                <a href="../beyond_the_basics/defaulting_and_canonicalization_with_webhooks.html">
            
                    
                    Defaulting and Canonicalization using Webhooks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.9" data-path="../beyond_the_basics/debugging_resources.html">
            
                <a href="../beyond_the_basics/debugging_resources.html">
            
                    
                    Debugging Resources
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.2" >
            
                <span>
            
                    
                    Controllers
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.2.1" data-path="../beyond_the_basics/generating_unique_object_names.md">
            
                <span>
            
                    
                    Generating Unique Object Names
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2.2" data-path="../beyond_the_basics/finalizers_and_garbage_collection.html">
            
                <a href="../beyond_the_basics/finalizers_and_garbage_collection.html">
            
                    
                    Finalizers and Garbage Collection
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2.3" data-path="../beyond_the_basics/events_shared_informers_and_ratelimiting_queues.html">
            
                <a href="../beyond_the_basics/events_shared_informers_and_ratelimiting_queues.html">
            
                    
                    Events, Shared Informers and RateLimiting Queues
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2.4" data-path="../beyond_the_basics/logging_and_publishing_events.html">
            
                <a href="../beyond_the_basics/logging_and_publishing_events.html">
            
                    
                    Logging and Publishing Events
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2.5" data-path="../beyond_the_basics/debugging_controllers.html">
            
                <a href="../beyond_the_basics/debugging_controllers.html">
            
                    
                    Debugging Controllers
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.3" >
            
                <span>
            
                    
                    Controller Manager
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.3.1" data-path="../beyond_the_basics/initializing_and_wiring_dependencies.html">
            
                <a href="../beyond_the_basics/initializing_and_wiring_dependencies.html">
            
                    
                    Initializing and Wiring Shared Dependencies
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3.2" data-path="../beyond_the_basics/installing_crds.html">
            
                <a href="../beyond_the_basics/installing_crds.html">
            
                    
                    Installing CRDs
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Publishing and Running in Production</li>
        
        
    
        <li class="chapter " data-level="5.1" data-path="../publishing_and_running_in_production/integration_testing.html">
            
                <a href="../publishing_and_running_in_production/integration_testing.html">
            
                    
                    Integration Testing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="../publishing_and_running_in_production/monitoring_and_alerting.html">
            
                <a href="../publishing_and_running_in_production/monitoring_and_alerting.html">
            
                    
                    Monitoring and Alerting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.3" data-path="../publishing_and_running_in_production/build_and_release.html">
            
                <a href="../publishing_and_running_in_production/build_and_release.html">
            
                    
                    Build and Release
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.4" data-path="../publishing_and_running_in_production/package_and_publishing.html">
            
                <a href="../publishing_and_running_in_production/package_and_publishing.html">
            
                    
                    Packaging and Publishing
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Raw Extension Points</li>
        
        
    
        <li class="chapter " data-level="6.1" >
            
                <span>
            
                    
                    CustomResourceDefinitions
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="6.2" >
            
                <span>
            
                    
                    Annotations as Virtual Fields
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="6.3" >
            
                <span>
            
                    
                    Webhooks
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.3.1" >
            
                <span>
            
                    
                    Validating
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="6.3.2" >
            
                <span>
            
                    
                    Mutating
            
                </span>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="6.4" >
            
                <span>
            
                    
                    CRUD APIs
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.4.1" >
            
                <span>
            
                    
                    Get, List, Watch
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="6.4.2" >
            
                <span>
            
                    
                    Create, Update, Patch
            
                </span>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="6.5" >
            
                <span>
            
                    
                    Init Containers
            
                </span>
            

            
        </li>
    

    
        
        <li class="header">Reference</li>
        
        
    
        <li class="chapter " data-level="7.1" >
            
                <span>
            
                    
                    Resource Definitions
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="7.2" >
            
                <span>
            
                    
                    Controller Definitions
            
                </span>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Simple Resource Example</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <p><div class="panel panel-danger"><div class="panel-heading"><div class="panel-icon"><i class="icon-danger"></i></div><div class="panel-title">Under Development</div></div><div class="panel-content"><p>This book is currently under development and does not reflect the current state of
the kubebuilder project!</p>
<p>Some of the APIs and libraries described in this book are proposals, and have not yet
been implemented!</p>
</div></div></p>
<h1 id="simple-resource-example">Simple Resource Example</h1>
<p>This chapter walks through a simple Resource declaration.</p>
<div class="api-method"><div class="api-method-definition"><h2 id="type-definition">Type Definition</h2>
<p>This is a simple API resource definition example for an API that wraps and simplifies the Deployment API.</p>
<p>The resource contains the container image and replica count in the <em>Spec</em>, which should be read by
the controller and used to create and manage a new Deployment.</p>
<p>The resource also contains the number of healthy replicas in the <em>Status</em>, which should be updated
by the controller each time a new Pod becomes healthy.  Note: in order for the controller to
keep this field current, it will need to listen for Pod events and map them back to the owning
ContainerSet resource.</p>
<p>Lastly, resource has a both a TypeMeta and an ObjectMeta field.  The TypeMeta contains metadata about
the API itself - such as Group, Version, Kind.  The ObjectMeta contains metadata about the specific object
instance - such as the name, namespace, labels and annotations.</p>
<blockquote>
<p>$ kubebuilder create resource --group workloads --version v1beta1 --kind ContainerSet</p>
</blockquote>
</div><div class="api-method-code"><div class="api-method-sample" data-lang="go" data-name="Go"><blockquote>
<p>pkg/apis/workloads/v1beta1/containerset_types.go</p>
</blockquote>
<pre><code class="lang-go">
<span class="hljs-comment">// ContainerSetSpec defines the desired state of ContainerSet</span>
<span class="hljs-keyword">type</span> ContainerSetSpec <span class="hljs-keyword">struct</span> {
    <span class="hljs-comment">// replics is the number of replicas to maintain</span>
    Replicas <span class="hljs-keyword">int32</span> <span class="hljs-string">`json:&quot;replicas,omitempty&quot;`</span>

    <span class="hljs-comment">// image is the container image to run</span>
    Image <span class="hljs-keyword">string</span> <span class="hljs-string">`json:&quot;image,omitempty&quot;`</span>
}

<span class="hljs-comment">// ContainerSetStatus defines the observed state of ContainerSet</span>
<span class="hljs-keyword">type</span> ContainerSetStatus <span class="hljs-keyword">struct</span> {
    HealthyReplicas <span class="hljs-string">`json:&quot;healthyReplicas,omitempty&quot;`</span>
}

<span class="hljs-comment">// +genclient</span>
<span class="hljs-comment">// +k8s:deepcopy-gen:interfaces=k8s.io/apimachinery/pkg/runtime.Object</span>

<span class="hljs-comment">// ContainerSet creates a new Deployment running multiple replicas of a single container with the given</span>
<span class="hljs-comment">// image.</span>
<span class="hljs-comment">// +k8s:openapi-gen=true</span>
<span class="hljs-comment">// +resource:path=containersets</span>
<span class="hljs-keyword">type</span> ContainerSet <span class="hljs-keyword">struct</span> {
    metav1.TypeMeta   <span class="hljs-string">`json:&quot;,inline&quot;`</span>
    metav1.ObjectMeta <span class="hljs-string">`json:&quot;metadata,omitempty&quot;`</span>

    <span class="hljs-comment">// spec contains the desired behavior of the ContainerSet</span>
    Spec   ContainerSetSpec   <span class="hljs-string">`json:&quot;spec,omitempty&quot;`</span>

    <span class="hljs-comment">// status contains the last observed state of the ContainerSet</span>
    Status ContainerSetStatus <span class="hljs-string">`json:&quot;status,omitempty&quot;`</span>
}
</code></pre>
</div></div></div>

<p><div class="panel panel-info"><div class="panel-heading"><div class="panel-icon"><i class="icon-info"></i></div><div class="panel-title">Comment annotation directives</div></div><div class="panel-content"><p>The definition contains several comment annotations of the form <code>// +something</code>.  These are
used to configure code generators to create boilerplate code based on the go struct definition.  For
now we will ignore these.  To learn more on configuring code generation see the <em>Code Generation</em> chapter.</p>
</div></div></p>
<p><div class="panel panel-default"><div class="panel-heading"><div class="panel-title">Rerunning Code Generators</div></div><div class="panel-content"><p>While users don&apos;t directly modify generated code, users must rerun <code>kubebuilder generate</code>
after adding or modifying resources to update the generated code with the changes.</p>
</div></div></p>
<div class="api-method"><div class="api-method-definition"><h2 id="generated-boilerplate">Generated Boilerplate</h2>
<p>Kubebuilder generates boilerplate code required for registering the type with the apimachinery libraries,
implementing required interfaces such as <em>deep copying</em> objects, and providing CRD representations of
the resources.</p>
<p>Code generation may be configured by comment annotations of the form <code>// +something</code>.</p>
<blockquote>
<p>$ kubebuilder generate</p>
</blockquote>
</div><div class="api-method-code"><div class="api-method-sample" data-lang="go" data-name="Go"><p><em>This code snippet has been truncated for display purposes.</em></p>
<blockquote>
<p>pkg/apis/workloads/v1beta1/zz_generated.kubebuilder.go</p>
</blockquote>
<pre><code class="lang-go"><span class="hljs-comment">// SchemeGroupVersion is group version used to register these objects</span>
<span class="hljs-keyword">var</span> SchemeGroupVersion = schema.GroupVersion{Group: <span class="hljs-string">&quot;workloads.k8s.io&quot;</span>, Version: <span class="hljs-string">&quot;v1beta1&quot;</span>}

<span class="hljs-comment">// Kind takes an unqualified kind and returns back a Group qualified GroupKind</span>
<span class="hljs-keyword">func</span> Kind(kind <span class="hljs-keyword">string</span>) schema.GroupKind {
    <span class="hljs-keyword">return</span> SchemeGroupVersion.WithKind(kind).GroupKind()
}

<span class="hljs-comment">// Resource takes an unqualified resource and returns a Group qualified GroupResource</span>
<span class="hljs-keyword">func</span> Resource(resource <span class="hljs-keyword">string</span>) schema.GroupResource {
    <span class="hljs-keyword">return</span> SchemeGroupVersion.WithResource(resource).GroupResource()
}

<span class="hljs-keyword">var</span> (
    SchemeBuilder = runtime.NewSchemeBuilder(addKnownTypes)
    AddToScheme   = SchemeBuilder.AddToScheme
)
...
</code></pre>
</div></div></div>


                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            

        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Simple Resource Example","level":"3.2.2","depth":2,"next":{"title":"Controller Fundamentals","level":"3.3","depth":1,"ref":"","articles":[{"title":"What is a Contoller","level":"3.3.1","depth":2,"path":"basics/what_is_controller.md","ref":"basics/what_is_controller.md","articles":[]},{"title":"Simple Controller Example","level":"3.3.2","depth":2,"path":"basics/simple_controller.md","ref":"basics/simple_controller.md","articles":[]}]},"previous":{"title":"What is a Resource","level":"3.2.1","depth":2,"path":"basics/what_is_resource.md","ref":"basics/what_is_resource.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["theme-api","panel"],"pluginsConfig":{"theme-api":{"languages":[],"split":true,"theme":"light"},"panel":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"basics/simple_resource.md","mtime":"2018-04-23T14:49:19.157Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-04-23T14:49:24.178Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-theme-api/theme-api.js"></script>
        
    

    </body>
</html>

